<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>郑州四中英才二班典籍</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-image: url('https://static.shittim.art/images/acg_imageset/1.webp');
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            transition: background 0.3s ease;
        }
        header {
            background: transparent;
            color: white;
            text-align: center;
            padding: 1em 0;
            font-size: 1.5em;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .theme-button {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 10px;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s, box-shadow 0.3s, background-color 0.3s;
        }
        .theme-popup {
            position: absolute;
            top: 50px;
            right: 10px;
            background: white;
            padding: 10px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            display: none;
            z-index: 1000;
        }
        .theme-color {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s, box-shadow 0.3s;
            display: inline-block;
            margin: 5px;
        }
        .container {
            max-width: 800px;
            min-width: 300px;
            width: 80%;
            margin: 20px auto;
            padding: 20px;
            background: rgba(255, 255, 255, 0.9);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border-radius: 16px;
        }
        .entry {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding: 15px;
            background: var(--entry-bg-color, #e7f3ff);
            border-radius: 12px;
            word-wrap: break-word;
            overflow: hidden;
            position: relative;
            min-height: 40px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
            min-height: 80px; /* 修改此处,提高每一栏的高度 */
        }
        .entry:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }
        .entry-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            min-height: 20px;
        }
        .entry-time, .entry-contributor {
            font-size: 0.8em;
            color: #aaa;
        }
        .entry-unsure {
            color: var(--unsure-color, #FFA500);
            font-weight: bold;
            font-size: 1.1em;
            margin-left: 10px;
        }
        .entry.sensitive {
            backdrop-filter: blur(5px);
            position: relative;
            overflow: hidden;
            min-height: 80px; /* 修改此处,提高每一栏的高度 */
        }
        .sensitive-box {
            filter: blur(10px);
            position: relative;
            overflow: hidden;
        }
        .sensitive-box.revealed {
            filter: none;
        }
        .entry.sensitive.revealed {
            filter: none;
        }
        .sensitive-warning {
            position: absolute;
            /*top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);*/
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            /*padding: 15px;*/
            border-radius: 8px;
            text-align: left;
            pointer-events: auto;
            z-index: 1; /* 确保在模糊层上方 */
            display: flex; /* 使用 Flex 布局 */
            align-items: center; /* 垂直居中 */
            justify-content: center; /* 水平居中 */
            background-color: rgba(0, 0, 0, 0.5);
            border-radius: 12px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
            padding:25px;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            transform: none;
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            backdrop-filter: blur(5px);
        }

        .sensitive-warning svg {
            vertical-align: middle;
            margin-right: 5px;
        }
        .entry.revealed .sensitive-warning {
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        .pagination {
            text-align: center;
            margin: 20px 0;
        }
        .pagination a {
            text-decoration: none;
            color: #007BFF;
            padding: 10px 15px;
            border: 1px solid #ddd;
            margin: 0 5px;
            border-radius: 8px;
            transition: background-color 0.3s, color 0.3s;
        }
        .pagination a:hover {
            background-color: #007BFF;
            color: white;
        }
        footer {
            text-align: center;
            padding: 10px 0;
            background: transparent;
            color: white;
            margin-top: auto;
        }
        @media (max-width: 600px) {
            .container {
                width: 90%;
            }
        }
        .show-button {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background-color: rgba(5, 4, 4, 0.5);
            color: rgb(255, 255, 255);
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 16px;
            padding: 8px 16px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            transition: background-color 0.3s;
        }
        .icon-container {
            margin-bottom: 10px;
        }
        .text-container {
            text-align: center;
        }
    </style>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0&icon_names=visibility_off" />
</head>
<body>
<header>郑州四中英才二班典籍</header>
<button class="theme-button">颜色选择</button>
<div class="theme-popup">
    <div class="theme-color" style="background-color: #28a745;" data-page-bg="#28a745" data-entry-bg="#d4edda"></div>
    <div class="theme-color" style="background-color: #007BFF;" data-page-bg="#007BFF" data-entry-bg="#cce5ff"></div>
    <div class="theme-color" style="background-color: #ffc107;" data-page-bg="#ffc107" data-entry-bg="#fff3cd"></div>
    <div class="theme-color" style="background-color: #ff69b4;" data-page-bg="#ff69b4" data-entry-bg="#ffe4e1"></div>
</div>
<div class="container"></div>
<div class="pagination"></div>
<footer style="user-select: none;">
    &copy; 郑州市第四高级中学英才二班
    <br>
    声明：本网站所记录任何内容与网站所有者无关，网站记录的任何条目造成的任何负面影响与网站所有者无关
    <br>
    如果你认为本网站某些内容侵犯了您的合法权益，网站所有者乐意为您删除你认为不合理的内容
</footer>
<script nomodule defer src="https://cdn.jsdelivr.net/npm/katex@0.16.18/dist/katex.js" integrity="sha384-zuSLTEzan5q8B3VF09V3GHDwr7/cqxebTOtipDSItrKsHX2qgt+5GB1sti60+AHt" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/markdown-it@14.1.0/dist/markdown-it.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.18/dist/katex.css" integrity="sha384-9PvLvaiSKCPkFKB1ZsEoTjgnJn+O3KvEwtsz37/XrkYft3DTk2gHdYvd9oWgW3tV" crossorigin="anonymous">
<script type="module">
    import katex from 'https://cdn.jsdelivr.net/npm/katex@0.16.18/dist/katex.mjs';
    import markdownIt from 'https://cdn.jsdelivr.net/npm/markdown-it@14.1.0/+esm';

    const md = markdownIt({
        html: true,
        typographer: true
    })

    md.renderer.rules.image = function (tokens, idx) {
        const token = tokens[idx];
        const src = token.attrGet('src')
        const alt = token.content
        let width = token.attrGet('width') || '100%'
        let height = token.attrGet('height') || '100%'

        if (!width.endsWith('%')) {
            if(!width.endsWith('px')) {
                width = width + 'px'
            }
        }
        if(!height.endsWith('%')) {
            if(!height.endsWith('px')) {
                height = height + 'px'
            }
        }

        return `<img src="${src}" alt="${alt}" style="width: ${width}; height: ${height}">`
    }

    //md.use(katex)

    const data = {"data":[
            {"time":"2024-01-17 09:30:55","content":"city指着后面黑板上一行字$^{\\textcircled{1}}$：我勒个繁体字啊，哪有繁体字这么写的\n\n$\\textcircled{1}$ 原文为 \"計算通り，完璧きー\"","contributor":null,"unsure":false,"sensitive":false},
            {"time":"不详","content":"![迟到人员名单](https://static.shittim.art/images/20241220151151%20%E7%AC%AC1%E9%A1%B5.png) ![xswl](https://static.shittim.art/images/a35fb8cbe853ecaaf3fa79487fe5513e.jpg)","contributor":"学生A","unsure":true,"sensitive":false},
            {"time":"2024-11-14 09:30:55","content":"<img src=https://static.shittim.art/images/20241220151151%20%E7%AC%AC1%E9%A1%B5.png style='width:300px;'>","contributor":"学生D","unsure":false,"sensitive":false},
            {"time":"2024-02-12 09:30:55","content":"参加了学校组织的义务劳动。","contributor":"学生D","unsure":false,"sensitive":false},
            {"time":"待定","content":"提出了一个非常有趣的问题。","contributor":"学生B","unsure":true,"sensitive":true}
        ]};
    const itemsPerPage = 7;
    let currentPage = 1;
    const totalPages = Math.ceil(data.data.length / itemsPerPage);
    const container = document.querySelector('.container');
    const pagination = document.querySelector('.pagination');
    const themeButton = document.querySelector('.theme-button');
    const themePopup = document.querySelector('.theme-popup');
    const themeColors = document.querySelectorAll('.theme-color');

    function loadTheme() {
        const savedPageBg = localStorage.getItem('pageBgColor') || '#007BFF';
        const savedEntryBg = localStorage.getItem('entryBgColor') || '#e7f3ff';
        document.body.style.setProperty('--page-bg-gradient', `linear-gradient(135deg, ${savedPageBg}, #f9f9f9)`);
        document.documentElement.style.setProperty('--entry-bg-color', savedEntryBg);
        themeButton.style.backgroundColor = savedPageBg;
        if (savedPageBg === '#ffc107') {
            document.documentElement.style.setProperty('--unsure-color', '#FF0000');
        } else {
            document.documentElement.style.setProperty('--unsure-color', '#FFA500');
        }
    }

    themeButton.addEventListener('click', () => {
        themePopup.style.display = themePopup.style.display === 'block' ? 'none' : 'block';
    });

    themeColors.forEach(color => {
        color.addEventListener('click', () => {
            const pageBg = color.getAttribute('data-page-bg');
            const entryBg = color.getAttribute('data-entry-bg');
            localStorage.setItem('pageBgColor', pageBg);
            localStorage.setItem('entryBgColor', entryBg);
            loadTheme();
            themePopup.style.display = 'none';
        });
    });

    function renderPagination() {
        pagination.innerHTML = '';
        const home = document.createElement('a');
        home.textContent = '首页';
        home.href = '#';
        home.onclick = () => {
            currentPage = 1;
            renderPage(currentPage);
            return false;
        };
        pagination.append(home);

        const prevLink = document.createElement('a');
        prevLink.textContent = '上一页';
        prevLink.href = '#';
        prevLink.onclick = () => {
            if (currentPage > 1) {
                currentPage--;
                renderPage(currentPage);
            }
            return false;
        };
        pagination.appendChild(prevLink);

        if(totalPages <= 10) {
            for(let i = 1; i <= totalPages; i++) {
                const pageLink = document.createElement('a');
                pageLink.textContent = i.toString();
                pageLink.href = '#';
                if (i === currentPage) {
                    pageLink.style.fontWeight = '900';
                }
                pageLink.onclick = () => {
                    currentPage = i;
                    renderPage(currentPage);
                    return false;
                };
                pagination.appendChild(pageLink);
            }
        } else {
            let lef = 0, rig = 0;
            if(currentPage <= 5) {
                lef = currentPage - 1;
                rig = 10 - lef;
            }
            else if(currentPage >= totalPages - 5) {
                rig = totalPages - currentPage
                lef = 10 - rig;
            } else {
                lef = 5;
                rig = 5;
            }
            for(let i = currentPage - lef; i <= currentPage + rig; i++) {
                const pageLink = document.createElement('a');
                pageLink.textContent = i.toString();
                pageLink.href = '#';
                if (i === currentPage) {
                    pageLink.style.fontWeight = '900';
                }
                pageLink.onclick = () => {
                    currentPage = i;
                    renderPage(currentPage);
                    return false;
                };
                pagination.appendChild(pageLink);
            }
        }

        const nextLink = document.createElement('a');
        nextLink.textContent = '下一页';
        nextLink.href = '#';
        nextLink.onclick = () => {
            if (currentPage < totalPages) {
                currentPage++;
                renderPage(currentPage);
            }
            return false;
        };
        pagination.appendChild(nextLink);

        const end = document.createElement('a');
        end.textContent = '末页';
        end.href = '#';
        end.onclick = () => {
            currentPage = totalPages;
            renderPage(currentPage);
            return false;
        }
        pagination.appendChild(end);
    }

    function renderPage(pageNumber) {
        container.innerHTML = '';
        const start = (pageNumber - 1) * itemsPerPage;
        const end = start + itemsPerPage;
        const pageEntries = data.data.slice(start, end);

        pageEntries.forEach(entry => {
            const div = document.createElement('div');
            div.className = 'entry';
            if (entry.sensitive) {
                div.classList.add('sensitive');
            }

            const headerDiv = document.createElement('div');
            headerDiv.className = 'entry-header';

            const timeContribDiv = document.createElement('div');
            timeContribDiv.style.display = 'flex';
            timeContribDiv.style.alignItems = 'center';

            const timeSpan = document.createElement('span');
            timeSpan.className = 'entry-time';
            timeSpan.textContent = entry.time;

            const contribSpan = document.createElement('span');
            contribSpan.className = 'entry-contributor';
            contribSpan.textContent = entry.contributor || '';
            contribSpan.style.marginLeft = '10px';

            timeContribDiv.appendChild(timeSpan);
            timeContribDiv.appendChild(contribSpan);

            headerDiv.appendChild(timeContribDiv);

            if (entry.unsure) {
                const unsureSpan = document.createElement('span');
                unsureSpan.className = 'entry-unsure';
                unsureSpan.textContent = '本条目真实性有待考究';
                headerDiv.appendChild(unsureSpan);
            }

            const contentDiv = document.createElement('div');
            const pattern = /\$(.*?)\$/g;
            function render_(p1) {
                return katex.renderToString(p1)
            }
            contentDiv.innerHTML = md.render(entry.content).replace(
                pattern,
                (match, p1) => render_(p1)
            )
            //contentDiv.innerHTML = md.render(entry.content)
            //contentDiv.textContent = entry.content;

            const box = document.createElement('div');
            box.appendChild(headerDiv);
            box.appendChild(contentDiv);

            if(entry.sensitive) {
                box.className = 'sensitive-box';
            }

            //div.appendChild(headerDiv);
            //div.appendChild(contentDiv);
            div.appendChild(box);

            if (entry.sensitive) {
                const warningDiv = document.createElement('div');
                warningDiv.className = 'sensitive-warning';
                warningDiv.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="24" height="24">
                            <path d="M0 0h24v24H0zm0 0h24v24H0zm0 0h24v24H0zm0 0h24v24H0z" fill="none"/>
                            <path d="M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7zM2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3 2 4.27zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2zm4.31-.78l3.15 3.15.02-.16c0-1.66-1.34-3-3-3l-.17.01z"/>
                        </svg>
                        <span style="display: inline-block; vertical-align: middle;">This content contains sensitive information.</span>
                    `;

                const showButton = document.createElement('button');
                showButton.innerHTML = 'Show';
                showButton.className = 'show-button';
                warningDiv.appendChild(showButton);

                div.appendChild(warningDiv);

                showButton.addEventListener('click', function () {
                    div.classList.add('revealed');
                    box.classList.add('revealed');
                });
            }
            container.appendChild(div);
        });
        renderPagination();
    }

    loadTheme();
    renderPage(currentPage);

    const params = new URLSearchParams(window.location.search);
    if(params.has('page')) {
        currentPage = parseInt(params.get('page'));
        if(currentPage > totalPages) {
            currentPage = totalPages;
        }
        if(currentPage < 1) {
            currentPage = 1;
        }
        renderPage(currentPage);
    }
</script>
</body>
</html>
